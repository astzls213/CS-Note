# Part2 应用层

本总结主要面向在校大学生**复习期末考试**，当然也能应付一些**面试**上的问题。这些总结都是作者**有感而发**，因此**不是那种被转发到臭的博文**。因此，各位水友看完觉得有收获可以**点个赞**满足博主那可怜的虚荣心。

总结由于俺龙鸣的学识以及时间有限，难免有错，感谢各路大神不吝赐教。

### 一些概念

- 万维网WWW：是一个分布式超媒体系统，所有的Web应用站点构成这样的系统。

### 灵魂拷问环节

本文在叙述应用层工作原理时涉及到了socket的一些工作原理，这应该是运输层的内容，如果现在看不懂没关系，先留着大概印象，到时候进入下一Part再去理解即可。

1. DNS是干嘛的？

   DNS全称Domain Name System，即域名系统。负责将人们容易记住的主机名（比如www.baidu.com）转换成对应的服务器IP地址。因此可以理解为，你在浏览器输入www.baidu.com，你（客户端）要与这个主机名对应的服务器建立TCP连接，就必须要知道该服务器的IP地址，因此必须先发送DNS查询报文。因此DNS是一个应用程序，因此也就属于应用层。你可能会好奇你怎么知道DNS服务器的IP地址，简单来说，你用的电信宽带通过DHCP协议提供给你本地的一个DNS服务器IP地址。

2. DNS服务器有哪几种？分别承担的作用？

   有以下四种：

   - 本地DNS服务器：当你查询一个域名所映射的IP地址时，通常就是发送DNS查询报文至一台本地DNS服务器，然后这台服务器帮你去查对应的IP地址。起到一个代理的作用，也起到负载均衡的作用。
   - 根DNS服务器：该服务器存储的仅仅是**顶级域DNS服务器的域名IP映射**。比如查询www.baidu.com时，服务器会返回给你com这个顶级域DNS服务器的IP地址，你再跑去找他查询。
   - 顶级域DNS服务器：该服务器提供权威DNS服务器的IP地址，和根DNS服务器同理。
   - 权威DNS服务器：权威，肯定是某种企业维护的服务器。服务器收录了许多域名到IP地址的映射，这种权威建立在信用上。现在你可以从该服务器查到www.baidu.com对应的IP地址了。

3. 简述DNS的两种查询过程。

   设你的电脑为A，本地DNS服务器为B，根DNS服务器为C，顶级域DNS服务器为D，权威DNS服务器为E。

   - 递归查询：A向B查询www.baidu.com的IP地址，B又代替A向C查询该URL，这就叫做递归查询。
   - 迭代查询：B向C查询www.baidu.com，C只向B告诉他应该去找D，然后B重新向D查询www.baidu.com。这就叫迭代查询。

4. 一个域名只能映射一个IP地址吗？不是的话，为什么？

   一个URL可以映射**不止一个**IP地址，因为现在Web应用基本都采用多台服务器提供Web服务。因此可以根据每台服务器的负载量，将URL映射至不同服务器的IP地址上，以实现负载均衡。

5. 简述DNS缓存的作用。

   避免网络上存在大量的DNS报文，导致网络拥堵。降低了DNS服务的响应时间，提高性能。

6. 说说DNS的管辖区概念。

   管辖区是由一个或多个权威DNS服务器组成的，这些服务器保存该管辖区所有域名到IP地址的映射。

7. 什么是FTP？并简述FTP工作过程。

   FTP全称File Transport Protocol，即文本传送协议。FTP是一个应用层协议，它使用TCP进行运输服务。FTP要求传送文件时要建立两个TCP连接，分别是：

   - 控制连接：FTP服务器的控制进程设置21端口的监听Socket，等待Client的连接，Client连接后，服务器accept产生新的socket作为连接套接字，client可以在这个套接字发送命令给服务器。
   - 数据连接：分为**主动模式**和**被动模式**。主动模式就是服务器通过20端口与客户端的监听套接字发起连接。因此客户端需要告诉服务端自己的监听端口。被动模式就是客户端主动发起与服务端的连接，服务端被动地监听着客户端的连接请求。被动模式安全性要比主动模式差，因为开放了过多的端口号。

   采用两个连接的原因是避免在数据传输时无法传输控制信息，必须等数据传完后才能传控制信息的尴尬局面。

8. 简述TELNET工作原理。

   TELNET是远程终端协议，是一种应用层协议。使用TCP作为运输协议，因此，客户端向远程服务器listen socket进行connect，服务器accept后将会create一个新的线程和新的连接套接字，线程与客户端通过连接套接字进行通信。用户发送用户名和密码至线程后，线程创建新的终端进程并进行登录。登录成功后用户就可以键入命令，命令的每个字符通过TCP连接传输至线程并传送给终端。终端的输出又返回给线程，线程通过TCP连接传输输出的字符至用户，用户的显示屏便显示接收到的数据。

9. 简述HTTP工作流程。

   HTTP为超文本传输协议，是一个应用层协议，用TCP作为运输协议。浏览器通过输入的URL向对应的服务器发起TCP连接请求，服务器accept后创建新的连接套接字，现在浏览器向该套接字发送HTTP请求，服务器解析后取得对应资源发送给浏览器，假设该资源是一个html文件，那么浏览器就会渲染该html文件显示给用户。

   HTTP可采用**持续连接**与**非持续连接**。

   - 持续连接是指浏览器与服务器建立的TCP连接不会马上释放掉，而是直到该连接空闲了一段时间才会释放。这样一个TCP连接可以传输好几个资源。
   - 非持续连接是指浏览器每接收一个资源就建立一个TCP连接。

   实际上，更具体一些，浏览器要先获得URL对应的IP地址。URL形式为：

   <`protocol`>://<`hostname`/`ip`>:<`port`>/<`path`>

   如果URL是`hostname`，则浏览器要向本地DNS服务器查询对应ip地址，刚说过了。HTTP服务器的`port`为80,HTTPS为443。

10. 代理服务器（Web缓存器）的作用是什么？

    **一句话，减少了整个网络的流量，使用户获取Web资源速度大大提高。**代理服务器其实扮演着即是客户又是服务器的双重身份。代理服务器通常由ISP提供，比如你请求www.baidu.com，并且浏览器配置了代理服务器的地址，那么浏览器先向代理服务器发起HTTP请求，代理服务器若有此资源副本，则直接HTTP响应至用户浏览器。否则，代理服务器向www.baidu.com所对应服务器发送HTTP请求，获得资源后保留一份在其本地，再返回给用户浏览器。

11. 电子邮件系统由哪部分组成？各自的作用是什么？

    - 用户代理：可以类比做浏览器，就像什么网易邮箱大师，这些就是你的用户代理。用户代理完成的工作就是将用户攥写的邮件发送至邮件服务器，或者从邮件服务器读取邮件信息至本地，进行浏览。
    - 邮件服务器：就是个存放用户邮件的服务器。比如A向发邮件给B，A是先通过用户代理发送到一个邮件服务器S1，S1再发送给B的邮件服务器S2。发送成功后，B通过用户代理读取S2对应的邮件完成交付。
    - SMTP协议：全称Simple Mail Transfer Protocol，用于从发送方的邮件服务器发送数据至接收方的邮件服务器（Port 25），或发送方的用户代理至发送方的邮件服务器（Port 587），使用TCP作为运输协议，是一个推协议。
    - POP3协议：全称Post Office Protocol。用户代理与邮件服务器的110端口建立TCP连接，这个端口就是POP3的专用端口。POP3主要内容就是认证、事务处理、更新。认证就是认证用户代理的身份，事务处理顾名思义就是处理用户的请求，比如取回邮件，删除邮件等。更新就是更新事务的操作，比如删除事务在事务处理阶段只是做了删除标记而已，等到更新阶段才正式从磁盘删除数据。

12. 为什么发送邮件不直接发送到对方的邮件服务器而是自己的邮件服务器？

    因为对方的邮件服务器可能处于关闭状态（比如维护），那么用户代理就要再发一遍，这样的代价就是用户必须手动尝试直到邮件发送成功，非常不人性化，所以不妨发送给邮件服务器，让服务器帮助我们失败重传。

13. 什么是动态主机配置协议DHCP？

    全称Dynamic Host Configuration Protocol，这个协议的作用就是配置你电脑的IP地址等信息。我们之所以能够上网就是靠IP地址，以及本地DNS服务器IP地址和网关地址。DHCP工作过程如下：

    - 客户端发送 Discover 报文，该报文的目的地址为 255.255.255.255:67，源地址为 0.0.0.0:68，被放入 UDP 中，该报文被广播到同一个子网的所有主机上。如果客户端和 DHCP 服务器不在同一个子网，就需要使用中继代理。
    - DHCP 服务器收到 Discover 报文之后，发送 Offer 报文给客户端，该报文包含了客户端所需要的信息。因为客户端可能收到多个 DHCP 服务器提供的信息，因此客户端需要进行选择。
    - 如果客户端选择了某个 DHCP 服务器提供的信息，那么就发送 Request 报文给该 DHCP 服务器。
    - DHCP 服务器发送 Ack 报文，表示客户端此时可以使用提供给它的信息。

### 总结

总的来说，我认为应用层就是为特定应用场景下诞生的协议层，不同的应用场景需要不同的信息，因此有着不同的协议。

比如HTTP超文本传输协议，超文本是一种资源，并且是一种动态资源，可以让用户看到形式多样的媒体（html，图片，视频等），并且我们需要对这种资源进行交互，因此我们必须设计一种交互规范，以便服务器能够根据特定格式解析我们的请求，是我们得到更好地服务，这就是HTTP协议的诞生。

但是，应用层只定义了应用程序之间应该以什么样的规范进行通信，但没有定义这些信息是如何在进程之间流动的，接下来，让我们进入下一层，运输层。

